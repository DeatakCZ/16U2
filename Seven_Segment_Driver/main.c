/* 
 * File:   main.c
 * Author: PanTalir
 *
 * Created on 02 July 2024, 17:18
 */
//---DEFINES--------------------------------------------------------------------
#define F_CPU 8000000UL
//---LIBRARIES------------------------------------------------------------------
#include <stdio.h>
#include <stdlib.h>
#include <avr/interrupt.h>
#include <xc.h>
#include <util/delay.h>
#include <avr/cpufunc.h>
//---FILES----------------------------------------------------------------------
#include "config.h"
//------------------------------------------------------------------------------
/*
 * 
 */
//---GLOBAL_SET-UP--------------------------------------------------------------
long counter = 0;
//------------------------------------------------------------------------------
//---MAIN_FUNCTION--------------------------------------------------------------
int main(void) 
{ 
//---SET-UP TIMER---------------------------------------------------------------
    TCCR0A = ( 0<<COM0A1 | 0<<COM0A0 | 0<<COM0B1 | 0<<COM0B0 | 1<<WGM01 | 0<<WGM00 );
    TCCR0B = ( 0<<WGM02  | 0<<CS02   | 0<<CS01   | 1<<CS00   );
    OCR0A =  ( 0xC7 );      //  199
    
    TIMSK0 = ( 1<<OCIE0A );
//------------------------------------------------------------------------------
//---SET-UP_I/O-----------------------------------------------------------------

    DDRB  = 0xF0;
    PORTB = 0xD0;
    
    DDRC  = 0x80;
    PORTC = 0x80;
//------------------------------------------------------------------------------
//---SET-UP_MISC----------------------------------------------------------------
    uint8_t i = 0;
    uint16_t Timer = 0;
    uint16_t bTimer1 = 0;
    uint8_t S = 1;
    //TCCR0B = ( 1<<CS00 | 1<<CS02);        //Start timer
    sei();                      //global interrupts enable        

    uint8_t numbers[16] = { 0x00, 0x10, 0x20, 0x30, 0x40, 0x50, 0x60, 0x70, 0x80, 0x90, 0xA0, 0xB0, 0xC0, 0xD0, 0xE0, 0xF0}; 

    _NOP();
//------------------------------------------------------------------------------    
//---MAIN_LOOP------------------------------------------------------------------    
    while(1)
    {
        //Timer input
        if(counter >= 1000)                     //20Hz
        {
            Timer++;
            counter = 0;
        }
        //Symbol output
        if(Timer>=40)      //0.5Hz
        {
            Timer = 0;
            PORTB = numbers[i];
            i++;
        }
        //Cycle reset  
        if(i==16)
        {
            i = 0;
        }
        
        }        
    return 0;
}
//------------------------------------------------------------------------------
//---INTERRUPT_SERVICE_ROUTINE--------------------------------------------------
ISR(TIMER0_COMPA_vect)                          //F = 20.000Hz = 20.000/s
{  
    counter++;
}
//------------------------------------------------------------------------------


