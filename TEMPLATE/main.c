/* 
 * File:   main.c
 * Author: PanTalir
 *
 * Created on 04 July 2024, 15:41
 */
//---DEFINITIONS----------------------------------------------------------------
#define F_CPU 8000000UL
//---LIBRARIES------------------------------------------------------------------
#include <stdio.h>
#include <stdlib.h>
#include <avr/interrupt.h>
#include <xc.h>
#include <util/delay.h>
#include <avr/cpufunc.h>
//---FILES----------------------------------------------------------------------
#include "config.h"
//------------------------------------------------------------------------------
/*
 * 
 */
//---GLOBAL_SET-UP--------------------------------------------------------------
long counter = 0;
//------------------------------------------------------------------------------
//---MAIN_FUNCTION--------------------------------------------------------------
int main(void) 
{ 
//---SET-UP TIMER---------------------------------------------------------------
    TCCR0A = ( 0<<COM0A1 | 0<<COM0A0 | 0<<COM0B1 | 0<<COM0B0 | 1<<WGM01 | 0<<WGM00 );
    TCCR0B = ( 0<<WGM02  | 0<<CS02   | 0<<CS01   | 1<<CS00   );
    OCR0A =  ( 0xC7 );      //  199
    
    TIMSK0 = ( 1<<OCIE0A );
    _NOP();
//------------------------------------------------------------------------------
//---SET-UP_I/O-----------------------------------------------------------------

    _NOP();
//------------------------------------------------------------------------------
//---SET-UP_MISC----------------------------------------------------------------
    uint16_t Timer = 0;


    //sei();                      //global interrupts enable        
    _NOP();
//------------------------------------------------------------------------------    
//---MAIN_LOOP------------------------------------------------------------------    
    while(1)
    {
        //Timer input
        if(counter >= 1000)                     //20Hz - 40x/s
        {
            Timer++;
            counter = 0;
        }
        if(Timer>=40)                           //0.5Hz - 01x/s
        {
            Timer = 0;
        }
    }        
    return 0;
}
//------------------------------------------------------------------------------
//---INTERRUPT_SERVICE_ROUTINE--------------------------------------------------
ISR(TIMER0_COMPA_vect)                          //F = 20.000Hz = 20.000/s
{  
    counter++;
}
//------------------------------------------------------------------------------